<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Vince Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Vince Blog">
<meta property="og:url" content="https://www.uetty.com/index.html">
<meta property="og:site_name" content="Vince Blog">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vince Blog">
  
    <link rel="alternate" href="/atom.xml" title="Vince Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Vince Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/s" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q1" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q6" value="www.uetty.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-log4j" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/08/15/log4j/" class="article-date">
  <time datetime="2019-08-15T14:36:07.000Z" itemprop="datePublished">2019-08-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/08/15/log4j/">log4j xml配置文件个人配置如何不污染GIT远程仓库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在spring中通常使用xml方式配置log4j。通常开发人员根据自身习惯会在本地开发环境设置令自己舒适的日志打印级别，然而在团队合作编程中，常因配置文件误提交导致污染GIT远程仓库。</p>
<p>针对这个问题，这里分享一个小经验——借助命令行参数在不改变文件的情况下，使配置更加的舒适</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><ol>
<li><p>首先修改xml配置文件的参数为<code>${}</code>形式，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;logger name=&quot;com.xxx.dao&quot; level=&quot;$&#123;sys:log4j.level.dao:-WARN&#125;&quot; additivity=&quot;false&quot;&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;CONSOLE&quot;/&gt;</span><br><span class="line">&lt;/logger&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行命令添加参数值设置自己的习惯级别，IDEA为例在<code>VM options</code>后补加一个变量<code>log4j.level.dao</code>的参数设定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dlog4j.level.dao=debug</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>此时，使用配置了该参数的启动项启动日志级别即为debug级别</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>实际上，添加VM options参数的方式，不止适用于这里，同样适用于覆盖已有的properties文件、yml文件的配置，只是log4j比较特殊，这里特意写篇博客单独记述。<br>在log4j中，<code>${}</code>的使用方式与其他地方有所不同</p>
<ol>
<li>log4j中的<code>${}</code>并不能识别项目的properties文件的内容</li>
<li>log4j中的<code>${}</code>属性引用格式与其他地方不同，下面具体解释</li>
</ol>
<p>在log4j中，<code>${}</code>参数<code>sys:log4j.level.dao:-WARN</code>中，<code>sys</code>表示使用<code>SystemPropertiesLookup</code>转化参数，<code>:</code>和<code>:-</code>之间表示属性名，<code>:-</code>之后表示默认值。<code>Lookup</code>的类型可在<code>org.apache.logging.log4j.core.lookup.Interpolator#Interpolator(java.util.Map&lt;java.lang.String,java.lang.String&gt;)</code>中看到，有多个不同的lookup。</p>
<p>去官网转了一圈，也有看到lookup使用的相关介绍<a href="https://logging.apache.org/log4j/2.x/manual/lookups.html#SystemPropertiesLookup" target="_blank" rel="noopener">链接</a>，但说实话，没看过源码的话可能不是很好理解，所以最好还是稍微阅读一下源码</p>
<p>题外话，看了log4j部分源码，实际上log4j获取默认配置文件地址的源码位于<code>org.apache.logging.log4j.core.config.ConfigurationFactory.Factory#getConfiguration(boolean, java.lang.String)</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/08/15/log4j/" data-id="ck0v87snj001plwukdb5lfhia" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log4j/">log4j</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-common-excel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/31/common-excel/" class="article-date">
  <time datetime="2019-07-31T14:36:06.000Z" itemprop="datePublished">2019-07-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/31/common-excel/">阿里Easy Excel自定义样式注解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>现在是第一版common-excel，基于<code>alibaba/easyexcel</code>依赖进行样式扩展封装而来的，增加了一些样式注解</p>
<h2 id="可以解决什么问题"><a href="#可以解决什么问题" class="headerlink" title="可以解决什么问题"></a>可以解决什么问题</h2><ol>
<li>注解式样式</li>
<li>代码方式自定义样式</li>
<li>冻结行列样式</li>
<li>合并单元格样式</li>
<li>设置内容下拉框</li>
<li>背景颜色</li>
<li>字体设置</li>
<li>列宽度设置</li>
<li>边框样式</li>
<li>居中方式</li>
<li>是否换行</li>
</ol>
<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p><img src="../static/MB19073101-1.png" alt="img - 1"> </p>
<p><img src="../static/MB19073101-2.png" alt="img - 2"> </p>
<h2 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h2><p>model代码示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@CellFreeze(freezeRow = 2, freezeCol = 2)</span><br><span class="line">// 宽度默认值</span><br><span class="line">@ColumnWidth(width = 40)</span><br><span class="line">// 同时作用于表标题和内容的样式默认值</span><br><span class="line">@CellStyle(fontStyle = @FontStyle(color = IndexedColors.LIGHT_BLUE, size = 14))</span><br><span class="line">public class MyModel1 extends BaseRowModel &#123;</span><br><span class="line"></span><br><span class="line">    // easyexcel 解析注解</span><br><span class="line">    @ExcelProperty(value=&#123;&quot;pri&quot;, &quot;pr1&quot;&#125;, index = 0)</span><br><span class="line">    private String pr1;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(value=&#123;&quot;pri&quot;, &quot;pr2&quot;&#125;, index = 1)</span><br><span class="line">    private String pr2;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(value = &#123;&quot;propValue1&quot;&#125;, index = 2)</span><br><span class="line">    // 数组方式指定的下拉框约束</span><br><span class="line">    @ExplicitConstraint(source = &#123;&quot;aaa1&quot;, &quot;aaa2&quot;, &quot;aaa3&quot;&#125;)</span><br><span class="line">    @ColumnWidth(width = 100)</span><br><span class="line">    private String propValue1;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(value = &#123;&quot;propValue2&quot;&#125;, index = 3)</span><br><span class="line">    @ExplicitConstraint(enumSource = MyConstraintEnum.class)</span><br><span class="line">    private String propValue2;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(value = &#123;&quot;score&quot;&#125;, index = 4)</span><br><span class="line">    @ColumnWidth(width = 50)</span><br><span class="line">    private Integer score;</span><br><span class="line"></span><br><span class="line">    @ExcelProperty(value = &#123;&quot;date&quot;&#125;, index = 5, format = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private Date date;</span><br><span class="line"></span><br><span class="line">    public String getPr1() &#123;</span><br><span class="line">        return pr1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPr1(String pr1) &#123;</span><br><span class="line">        this.pr1 = pr1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPr2() &#123;</span><br><span class="line">        return pr2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPr2(String pr2) &#123;</span><br><span class="line">        this.pr2 = pr2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPropValue1() &#123;</span><br><span class="line">        return propValue1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPropValue1(String propValue1) &#123;</span><br><span class="line">        this.propValue1 = propValue1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPropValue2() &#123;</span><br><span class="line">        return propValue2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPropValue2(String propValue2) &#123;</span><br><span class="line">        this.propValue2 = propValue2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Integer getScore() &#123;</span><br><span class="line">        return score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setScore(Integer score) &#123;</span><br><span class="line">        this.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getDate() &#123;</span><br><span class="line">        return date;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDate(Date date) &#123;</span><br><span class="line">        this.date = date;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>详细代码戳下方链接<br><a href="https://github.com/Uetty/common-excel" target="_blank" rel="noopener">仓库主页</a></p>
<p><a href="https://github.com/Uetty/common-excel/blob/master/src/main/java/com/uetty/common/excel/demo/withhead/TestWithHeadModel.java" target="_blank" rel="noopener">有标题头demo</a></p>
<p><a href="https://github.com/Uetty/common-excel/blob/master/src/main/java/com/uetty/common/excel/demo/headless/TestHeadlessModel1.java" target="_blank" rel="noopener">无标题头demo1</a></p>
<p><a href="https://github.com/Uetty/common-excel/blob/master/src/main/java/com/uetty/common/excel/demo/headless/TestHeadlessModel2.java" target="_blank" rel="noopener">无标题头demo2</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/07/31/common-excel/" data-id="ck0v87snh001nlwuk2pq58xdv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/open-source/">open source</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-compare-list-vertor-cowlist" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/29/compare-list-vertor-cowlist/" class="article-date">
  <time datetime="2019-07-29T11:33:16.000Z" itemprop="datePublished">2019-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/29/compare-list-vertor-cowlist/">ArrayList、Vector、CopyOnWriteArrayList对比</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ArrayList、Vector、CopyOnWriteArrayList均是实现了List接口的容器，他们之间究竟有何区别？为何JDK要同时提供这三种List？本文针对这个问题，进行深入的探究。</p>
<h2 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h2><h3 id="1-研究一个类源码，首先了解它有哪些成员变量"><a href="#1-研究一个类源码，首先了解它有哪些成员变量" class="headerlink" title="1. 研究一个类源码，首先了解它有哪些成员变量"></a>1. 研究一个类源码，首先了解它有哪些成员变量</h3><p>查看ArrayList源码，可以很清除的看到，ArrayList最主要的成员变量就两个，变量的作用很明显，存储对象数组和记录数组内存储的变量个数，ArrayList内元素是以Array方式存储的，所以叫做ArrayList</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* The array buffer into which the elements of the ArrayList are stored.</span><br><span class="line">* The capacity of the ArrayList is the length of this array buffer. Any</span><br><span class="line">* empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA</span><br><span class="line">* will be expanded to DEFAULT_CAPACITY when the first element is added.</span><br><span class="line">*/</span><br><span class="line">transient Object[] elementData; // non-private to simplify nested class access</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* The size of the ArrayList (the number of elements it contains).</span><br><span class="line">*</span><br><span class="line">* @serial</span><br><span class="line">*/</span><br><span class="line">private int size;</span><br></pre></td></tr></table></figure>

<h3 id="2-针对特征功能的探究"><a href="#2-针对特征功能的探究" class="headerlink" title="2. 针对特征功能的探究"></a>2. 针对特征功能的探究</h3><p>ArrayList之所以是一个List，而不是Array，就在于ArrayList长度可以扩展，这里探究它在add元素时是如何进行扩容的。</p>
<p>查看add代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* Appends the specified element to the end of this list.</span><br><span class="line">*</span><br><span class="line">* @param e element to be appended to this list</span><br><span class="line">* @return &lt;tt&gt;true&lt;/tt&gt; (as specified by &#123;@link Collection#add&#125;)</span><br><span class="line">*/</span><br><span class="line">public boolean add(E e) &#123;</span><br><span class="line">    ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出ArrayList的扩容是在ensureCapacityInternal方法中完成的，按着ensureCapacityInternal方法顺藤摸瓜可以找到grow方法这里才是真正的扩容代码，可以看出ArrayList扩容是直接用新的更长的数组替换掉旧的elementData数组，扩容后新容量是扩容前的容量的1.5倍，并与实际需求容量取最大值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* Increases the capacity to ensure that it can hold at least the</span><br><span class="line">* number of elements specified by the minimum capacity argument.</span><br><span class="line">*</span><br><span class="line">* @param minCapacity the desired minimum capacity</span><br><span class="line">*/</span><br><span class="line">private void grow(int minCapacity) &#123;</span><br><span class="line">    // overflow-conscious code</span><br><span class="line">    int oldCapacity = elementData.length;</span><br><span class="line">    int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</span><br><span class="line">    if (newCapacity - minCapacity &lt; 0)</span><br><span class="line">    newCapacity = minCapacity;</span><br><span class="line">    if (newCapacity - MAX_ARRAY_SIZE &gt; 0)</span><br><span class="line">    newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    // minCapacity is usually close to size, so this is a win:</span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a>Vector</h2><p>Vector类相比较ArrayList类，在成员变量上多了一个<code>protected int capacityIncrement</code>变量，主要用于扩容时的容量增长的计算，也就是说，Vector容量增长值的算法与ArrayList是有所不同的。</p>
<p>将关注点置于Vector与ArrayList类的不同点上，阅读源码可发现Vector类在<code>get</code>、<code>add</code>、<code>set</code>、<code>addAll</code>、<code>forEach</code>、<code>toArray</code>等方法上，均加了<code>synchronized</code>关键字，这里可以看出，Vector类与ArrayList相比增加了线程安全方面的考虑。</p>
<h2 id="CopyOnWriteArrayList"><a href="#CopyOnWriteArrayList" class="headerlink" title="CopyOnWriteArrayList"></a>CopyOnWriteArrayList</h2><p>成员变量上，主要增加了一个ReentrantLock变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/** The lock protecting all mutators */</span><br><span class="line">final transient ReentrantLock lock = new ReentrantLock();</span><br><span class="line"></span><br><span class="line">/** The array, accessed only via getArray/setArray. */</span><br><span class="line">private transient volatile Object[] array;</span><br></pre></td></tr></table></figure>

<p>了解<code>ReentrantLock</code>类的都知道，这是一个可重入锁，也就是说CopyOnWriteArrayList和Vector一样都有线程安全方面的考虑。那CopyOnWriteArrayList和Vector的区别是什么呢？</p>
<p>阅读CopyOnWriteArrayList源码发现，CopyOnWriteArrayList类在<code>get</code>、<code>forEach</code>、<code>toArray</code>等读的方法上，并没有加锁。在<code>add</code>、<code>set</code>、<code>addAll</code>等写的方法上除了使用了ReentrantLock锁之外，还增加了Array Copy的操作，使用Copy出的新的Array替换了就的Array，也正是因为这个操作，使得CopyOnWriteArrayList类在写的操作上不需要加锁。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>ArrayList与 CopyOnWriteArrayList和Vector的区别在于，CopyOnWriteArrayList和Vector是线程安全的，ArrayList不是线程安全的。CopyOnWriteArrayList和Vector的区别在于，CopyOnWriteArrayList读时不加锁，Vector读时加锁，CopyOnWriteArrayList写时进行了Array的拷贝，而Vector不进行拷贝。从性能上看，不加锁的ArrayList读写速度肯定都是最快的，而Vector写的速度比CopyOnWriteArrayList快，CopyOnWriteArrayList读的速度比Vector块。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/07/29/compare-list-vertor-cowlist/" data-id="ck0v87snf001ilwukq9mhknu5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-java-garbage-collector" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/17/java-garbage-collector/" class="article-date">
  <time datetime="2019-07-16T20:36:17.000Z" itemprop="datePublished">2019-07-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/17/java-garbage-collector/">JAVA垃圾收集器科普</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JAVA垃圾收集器"><a href="#JAVA垃圾收集器" class="headerlink" title="JAVA垃圾收集器"></a>JAVA垃圾收集器</h1><h2 id="Serial收集器（新生代）"><a href="#Serial收集器（新生代）" class="headerlink" title="Serial收集器（新生代）"></a>Serial收集器（新生代）</h2><p>垃圾收集时，必须暂停其他所有工作线程（Stop The World)，采用的是复制回收算法，单线程收集</p>
<h2 id="Serial-Old搜集器（老年代）"><a href="#Serial-Old搜集器（老年代）" class="headerlink" title="Serial Old搜集器（老年代）"></a>Serial Old搜集器（老年代）</h2><p>Serial收集器的老年代版本</p>
<h2 id="ParNew收集器（新生代）"><a href="#ParNew收集器（新生代）" class="headerlink" title="ParNew收集器（新生代）"></a>ParNew收集器（新生代）</h2><p>serial收集器的多线程版本，没有太多的提升</p>
<h2 id="Parallel-Scavenge收集器（新生代）"><a href="#Parallel-Scavenge收集器（新生代）" class="headerlink" title="Parallel Scavenge收集器（新生代）"></a>Parallel Scavenge收集器（新生代）</h2><p>复制回收算法，并发多线程收集器，特点是与其他关注缩短垃圾收集时停顿时间的收集器的关注点不同，目标是达到可控的吞吐量（=运行用户代码时间/(运行用户代码时间 + 垃圾收集时间)），参数的两种设置方式：</p>
<ol>
<li>使用<code>-XX:MaxGCPauseMillis</code>参数，直接制定大于0的毫秒数，收集器将尽可能地保证手机时间不超过设定值。但如果值设定过小，可能导致频繁垃圾回收。</li>
<li>使用<code>-XX:GCTimeRatio</code>参数，设定值大于0小于100整数，如果设定49，则GC时间占总时间的2%（1 / (1 + 49)），默认值为99.</li>
</ol>
<p>另外还有一个常用参数<code>-XX:+UseAdaptiveSizePolicy</code>，是开关参数，设定后无需手工指定新生代、Eden区、Survivor区的比例、晋升老年代年龄（<code>-XX:PretenureSizeThreshold</code>），虚拟机将自动调整这些参数以提供最适合的停顿时间和吞吐量。</p>
<h2 id="Parallel-Old收集器（老年代）"><a href="#Parallel-Old收集器（老年代）" class="headerlink" title="Parallel Old收集器（老年代）"></a>Parallel Old收集器（老年代）</h2><p>Parallel Scavenge收集器的老年代版本</p>
<h2 id="CMS收集器（老年代）"><a href="#CMS收集器（老年代）" class="headerlink" title="CMS收集器（老年代）"></a>CMS收集器（老年代）</h2><p>CMS(Concurrent Mark Sweep)收集器，是有较大提升的一个版本，采用的是标记清清理算法，同时是地一个真正意义上的并发收集器，以获取最短回收停顿时间为目标。</p>
<p>垃圾收集过程分为4个步骤：</p>
<ol>
<li>初始标记</li>
<li>并发标记</li>
<li>重新标记</li>
<li>并发清除</li>
</ol>
<p>初始标记、重新标记两个步骤仍旧需要”Stop The World”，但这两个阶段都是耗时比较短的阶段。初始标记，只是标记GC Roots能够直接到达的对象，速度很快；并发标记阶段为进行GC Tracing的过程；重新标记阶段为了修正并发标记期间用户程序继续运作而导致的标记变动部分记录，比初始标记阶段时间稍长，但远低于并发标记阶段。</p>
<p>不足点：</p>
<ol>
<li>并发程序的通病，对CPU资源敏感，线程占用资源不可避免的导致程序变慢（吞吐量降低），及线程切换的消耗，默认启动的线程数量（(CPU数量 + 3)  / 4）。</li>
<li>标记清楚回收算法的常见问题，导致内存空间的碎片，碎片过多大对象分配会带来麻烦，无法找到足够大空间时，不得不提前触发Full GC。参数<code>-XX:+UseCMSCompactAtFullCollection</code>用于在CMS收集器顶不住要FullGC时开启碎片压缩整合（默认即是开启的），但整合过程无法并发。参数<code>-XX:CMSFullGCsBeforeCompaction</code>设置多少次不压缩后执行一次压缩整合（默认值0）</li>
<li>收集器运行时需要为浮动垃圾（并发搜集阶段用户线程仍在运行而产生的垃圾）预留足够内存空间，浮动垃圾在下一次GC时清理掉，因此不能像其他收集器一样等到几乎被填满时再进行收集。JDK1.5中默认68%空间时收集，JDK1.6中为92%，使用<code>-XX:CMSInitiatingOccupancyFraction</code>参数设置百分比。</li>
<li>concurrent mark时预留的内存无法满足程序需要，会导致<code>Concurrent Mode Failure</code>失败，这是虚拟机启用后备预案，临时使用Serial Old收集器重新进行老年代的垃圾收集。</li>
<li>CMS作为老年代收集器，无法与Parallel Scavenge收集器配合使用，只能与Serial收集器或ParNew收集器配合使用</li>
</ol>
<h2 id="G1收集器（不再物理性分代）"><a href="#G1收集器（不再物理性分代）" class="headerlink" title="G1收集器（不再物理性分代）"></a>G1收集器（不再物理性分代）</h2><p>最新的收集器，目标替换CMS收集器，仍需要更多的检验。从2004年论文发布起，近10年时间才推出的G1收集器的商用版本，采用化整为零的思路，将Java堆分成多个Region进行管理。但由于对象的引用实现上并没有看起来这么简单，与新生代老年代类似，每个Region区均为此留出了Remembered Set来避免全堆扫描。</p>
<p>G1收集器运行大致分为4个步骤：</p>
<ol>
<li>初始标记</li>
<li>并发标记</li>
<li>最终标记</li>
<li>筛选回收</li>
</ol>
<p>4个阶段与CMS收集器相似，在最终标记阶段，将并发阶段写在线程Remembered Set Logs里的标记变动记录合并到Remembered Set中。筛选回收阶段对各个Region回收价值和成本先进行排序，根据用户期望GC停顿时间来制定回收计划。</p>
<p>G1收集器特点：</p>
<ol>
<li>并行与并发，多CPU环境缩短Stop-The-World</li>
<li>将整个Java堆分成多个大小相等的独立的Region，分代概念仍在G1收集器保留，但新生代和老年代不再是物理隔离的了，它们都是一部分Region的集合</li>
<li>可以不需要其他收集器配合就能独立管理整个GC堆，并能够采用不同方式处理新创建的和旧的对象</li>
<li>整体上采用”标记-整理”算法，局部（两个Region之间）基于”复制回收”算法</li>
<li>一大特色优势点，可预测的停顿。与CMS收集器一样关注降低停顿时间之外，还建立了可预测的停顿时间模型，能让使用者明确指定控制在长度为M的毫秒时间片段内，消耗在垃圾收集上的时间不超过N毫秒。</li>
</ol>
<p>可预测的停顿，建立在有计划地避免在整个Java堆中进行全区域垃圾收集，G1跟踪各个Region里的垃圾堆积的价值大小（回收所获得的空间大小以及回收所需时间的经验值），在后台维护一个优先级列表，每次根据允许的收集时间优先回收高价值Region （这也是Garbage-First名称的由来）。</p>
<p>Sun给出测试结果显示，G1收集器对停顿时间的控制比CMS要更加地稳定可靠得多。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/07/17/java-garbage-collector/" data-id="ck0v87sng001llwukov4w13pw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-java-linux-timezone" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/10/java-linux-timezone/" class="article-date">
  <time datetime="2019-07-10T13:11:18.000Z" itemprop="datePublished">2019-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/10/java-linux-timezone/">Java及Ubuntu操作系统时区错误</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>程序部署时出现Java时间不正确，Java里打印<code>new Date()</code>后发现输出的时区不是CST，是时区不正确导致的问题。针对该问题进行修复，修改时区设置，配置如下:</p>
<ol>
<li><p>修改<code>/etc/localtime</code>软链接指向为<code>/usr/share/zoneinfo/Asia/Shanghai</code></p>
<blockquote>
<p>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</p>
</blockquote>
</li>
</ol>
<p>此时出现了一个很有意思的现象：shell执行打印时间的命令<code>date</code>，发现输出时区为CST，但Java打印 <code>new Date()</code>输出，时区仍旧不是CST</p>
<ol start="2">
<li>修改<code>/etc/timezone</code>文件，将文件内唯一的一行<code>America/New_York</code>改为<code>Asia/Shanghai</code>，Java打印<code>new Date()</code>，输出时区为CST，修改成功</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/07/10/java-linux-timezone/" data-id="ck0v87snd001glwuk3a08s8ym" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-redis-vulnerability" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/13/redis-vulnerability/" class="article-date">
  <time datetime="2019-06-13T12:36:26.000Z" itemprop="datePublished">2019-06-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/13/redis-vulnerability/">利用Redis写文件提权登陆linux的漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>利用redis的config命令修改rdb文件地址为ssh密钥文件，向redis中写入公共密钥，通过save命令手动刷新到rdb中，此时就可以用私钥登陆了</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>在本地电脑中（linux为例）生成无密码的密钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -P &apos;&apos;    # 后面直接回车</span><br></pre></td></tr></table></figure>

<p>此时在~/.ssh/下生成两个文件<code>id_rsa</code>和<code>id_rsa.pub</code>，id_rsa是私钥，id_rsa_pub是公钥，公钥文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCf53Tg8bfLm8UQBFgm31YpMPuGDY3eWQ5GCiP4E7hdaSBvqSjeMjUOy5NWLg424BFWSFiKNF8oRBZpXtfhu+4AwgrwdSDJuKQtjJvrh7D+rnuxtzpGbqL/716S0e/+VHeh8PXnC+GPAMg72p7zDzHuYkvwkx/r6LSY9fspU25lHH4I9VrrxgPoS+BbU03i9LiGZFSTUSAljTJE3H5bPNpRPWlHlAZTxGXTYIGO+K2ZnUAg2+HtS246NONl6z1lVtxrS5G4yuiTeHJr+KWJD/DOiZ50EoYqbTHsjnTAM5MJTLHWH1jBIZ133OHW5RGmzyEuws6ge0Y6eGnxgwm2W09p uvince@DESKTOP-6JIM4T8</span><br></pre></td></tr></table></figure>

<p>进入服务器的redis命令行，输入如下一系列命令(注意ssh-rsa内容前后要有回车符\n)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">config set dir /.ssh</span><br><span class="line"></span><br><span class="line">config set dbfilename authorized_keys</span><br><span class="line"></span><br><span class="line">set ssh-test &quot;\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCf53Tg8bfLm8UQBFgm31YpMPuGDY3eWQ5GCiP4E7hdaSBvqSjeMjUOy5NWLg424BFWSFiKNF8oRBZpXtfhu+4AwgrwdSDJuKQtjJvrh7D+rnuxtzpGbqL/716S0e/+VHeh8PXnC+GPAMg72p7zDzHuYkvwkx/r6LSY9fspU25lHH4I9VrrxgPoS+BbU03i9LiGZFSTUSAljTJE3H5bPNpRPWlHlAZTxGXTYIGO+K2ZnUAg2+HtS246NONl6z1lVtxrS5G4yuiTeHJr+KWJD/DOiZ50EoYqbTHsjnTAM5MJTLHWH1jBIZ133OHW5RGmzyEuws6ge0Y6eGnxgwm2W09p uvince@DESKTOP-6JIM4T8\n&quot;</span><br><span class="line"></span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>此时，就已经往authorized_keys文件中写入了公钥</p>
<p>本地电脑使用命令<code>ssh -i ~/.ssh/id_rsa root@10.0.2.100</code>能够登陆服务器，这里-i后面是私钥的路径</p>
<p>这里面，有几个限制，一个是redis写文件的权限要能够到达该目录。现在写入的是root用户中，所以redis需要以root用户启动。如果知道某台服务器上有哪个用户，就可以把config set dir /.ssh 改为 config set dir /home/username/.ssh 了，最好还是redis和那个用户是同一个用户，这时候用config set dir ~/.ssh</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/06/13/redis-vulnerability/" data-id="ck0v8mk3v0002tsukrm5tgvj5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vulnerability/">vulnerability</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-javap-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/12/javap-example/" class="article-date">
  <time datetime="2019-06-12T11:58:49.000Z" itemprop="datePublished">2019-06-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/12/javap-example/">JAVAP 反汇编字节码案例</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>javap 命令可将Java class文件反汇编为字节码，借助该命令可排查一些特殊的bug</p>
<h2 id="bug案例问题介绍"><a href="#bug案例问题介绍" class="headerlink" title="bug案例问题介绍"></a>bug案例问题介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GithubTokenManager.GithubTokenRenter tokenRenter = null;</span><br><span class="line">        GithubSearchCodeVo vo = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            tokenRenter = tokenManager.tryGetAvailableToken(GET_TOKEN_DELAY, GithubTokenManager.RentType.SEARCH_CODE);</span><br><span class="line">            if (tokenRenter == null) &#123;</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            GithubToken token = tokenRenter.getToken();</span><br><span class="line">            vo = searchCodeList(keywords, scopes, page, perPage, token.getToken());</span><br><span class="line">            return vo;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (tokenRenter != null) &#123;</span><br><span class="line">                tokenRenter.giveBackToken(vo != null ? vo.getRateLimitRemain() : 1,       </span><br><span class="line">                        vo != null ? vo.getRateLimitReset() : 0L, vo != null ? vo.getRetryAfter() : null);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>上面代码运行，会出现偶现的NullPointerException，出现异常的代码位于<code>tokenRenter.giveBackToken(vo != null ? vo.getRateLimitRemain() : 1, vo != null ? vo.getRateLimitReset() : 0L, vo != null ? vo.getRetryAfter() : null)</code>，代码中涉及到的方法定义如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void giveBackToken(Integer, Long, Integer);</span><br><span class="line">Integer getRateLimitRemain();</span><br><span class="line">Long getRateLimitReset();</span><br><span class="line">Integer getRetryAfter();</span><br></pre></td></tr></table></figure>

<h2 id="问题排查步骤"><a href="#问题排查步骤" class="headerlink" title="问题排查步骤"></a>问题排查步骤</h2><p>使用javap命令对class文件进行反汇编，生成字节码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javap -c com.xxxx.xxxx.Githubxxxx</span><br></pre></td></tr></table></figure>

<p>得到字节码信息，字节码中相关代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">0: aconst_null</span><br><span class="line">       1: astore        5</span><br><span class="line">       3: aconst_null</span><br><span class="line">       4: astore        6</span><br><span class="line">       6: aload         4</span><br><span class="line">       8: ldc2_w        #122                // long 4000l</span><br><span class="line">      11: getstatic     #124                // Field com/secfox/service/github/GithubTokenManager$RentType.SEARCH_CODE:Lcom/secfox/service/github/GithubTokenManager$RentType;</span><br><span class="line">      14: invokevirtual #125                // Method com/secfox/service/github/GithubTokenManager.tryGetAvailableToken:(JLcom/secfox/service/github/GithubTokenManager$RentType;)Lcom/secfox/service/github/GithubTokenManager$GithubTokenRenter;</span><br><span class="line">      17: astore        5</span><br><span class="line">      19: aload         5</span><br><span class="line">      21: ifnonnull     94</span><br><span class="line">      24: aconst_null</span><br><span class="line">      25: astore        7</span><br><span class="line">      27: aload         5</span><br><span class="line">      29: ifnull        91</span><br><span class="line">      32: aload         5</span><br><span class="line">      34: aload         6</span><br><span class="line">      36: ifnull        50</span><br><span class="line">      39: aload         6</span><br><span class="line">      41: invokevirtual #126                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitRemain:()Ljava/lang/Integer;</span><br><span class="line">      44: invokevirtual #14                 // Method java/lang/Integer.intValue:()I</span><br><span class="line">      47: goto          51</span><br><span class="line">      50: iconst_1</span><br><span class="line">      51: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span><br><span class="line">      54: aload         6</span><br><span class="line">      56: ifnull        70</span><br><span class="line">      59: aload         6</span><br><span class="line">      61: invokevirtual #127                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitReset:()Ljava/lang/Long;</span><br><span class="line">      64: invokevirtual #51                 // Method java/lang/Long.longValue:()J</span><br><span class="line">      67: goto          71</span><br><span class="line">      70: lconst_0</span><br><span class="line">      71: invokestatic  #55                 // Method java/lang/Long.valueOf:(J)Ljava/lang/Long;</span><br><span class="line">      74: aload         6</span><br><span class="line">      76: ifnull        87</span><br><span class="line">      79: aload         6</span><br><span class="line">      81: invokevirtual #128                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRetryAfter:()Ljava/lang/Integer;</span><br><span class="line">      84: goto          88</span><br><span class="line">      87: aconst_null</span><br><span class="line">      88: invokevirtual #129                // Method com/secfox/service/github/GithubTokenManager$GithubTokenRenter.giveBackToken:(Ljava/lang/Integer;Ljava/lang/Long;Ljava/lang/Integer;)V</span><br><span class="line">      91: aload         7</span><br><span class="line">      93: areturn</span><br><span class="line">      94: aload         5</span><br><span class="line">      96: invokevirtual #130                // Method com/secfox/service/github/GithubTokenManager$GithubTokenRenter.getToken:()Ljava/lang/Object;</span><br><span class="line">      99: checkcast     #131                // class com/secfox/store/vo/github/GithubToken</span><br><span class="line">     102: astore        7</span><br><span class="line">     104: aload_0</span><br><span class="line">     105: aload_1</span><br><span class="line">     106: iload_2</span><br><span class="line">     107: iload_3</span><br><span class="line">     108: aload         7</span><br><span class="line">     110: invokevirtual #132                // Method com/secfox/store/vo/github/GithubToken.getToken:()Ljava/lang/String;</span><br><span class="line">     113: invokestatic  #133                // Method searchCodeList:(Ljava/lang/String;Ljava/lang/String;IILjava/lang/String;)Lcom/secfox/store/vo/github/GithubSearchCodeVo;</span><br><span class="line">     116: astore        6</span><br><span class="line">     118: aload         6</span><br><span class="line">     120: astore        8</span><br><span class="line">     122: aload         5</span><br><span class="line">     124: ifnull        186</span><br><span class="line">     127: aload         5</span><br><span class="line">     129: aload         6</span><br><span class="line">     131: ifnull        145</span><br><span class="line">     134: aload         6</span><br><span class="line">     136: invokevirtual #126                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitRemain:()Ljava/lang/Integer;</span><br><span class="line">     139: invokevirtual #14                 // Method java/lang/Integer.intValue:()I</span><br><span class="line">     142: goto          146</span><br><span class="line">     145: iconst_1</span><br><span class="line">     146: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span><br><span class="line">     149: aload         6</span><br><span class="line">     151: ifnull        165</span><br><span class="line">     154: aload         6</span><br><span class="line">     156: invokevirtual #127                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitReset:()Ljava/lang/Long;</span><br><span class="line">     159: invokevirtual #51                 // Method java/lang/Long.longValue:()J</span><br><span class="line">     162: goto          166</span><br><span class="line">     165: lconst_0</span><br><span class="line">     166: invokestatic  #55                 // Method java/lang/Long.valueOf:(J)Ljava/lang/Long;</span><br><span class="line">     169: aload         6</span><br><span class="line">     171: ifnull        182</span><br><span class="line">     174: aload         6</span><br><span class="line">     176: invokevirtual #128                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRetryAfter:()Ljava/lang/Integer;</span><br><span class="line">     179: goto          183</span><br><span class="line">     182: aconst_null</span><br><span class="line">     183: invokevirtual #129                // Method com/secfox/service/github/GithubTokenManager$GithubTokenRenter.giveBackToken:(Ljava/lang/Integer;Ljava/lang/Long;Ljava/lang/Integer;)V</span><br><span class="line">     186: aload         8</span><br><span class="line">     188: areturn</span><br><span class="line">     189: astore        9</span><br><span class="line">     191: aload         5</span><br><span class="line">     193: ifnull        255</span><br><span class="line">     196: aload         5</span><br><span class="line">     198: aload         6</span><br><span class="line">     200: ifnull        214</span><br><span class="line">     203: aload         6</span><br><span class="line">     205: invokevirtual #126                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitRemain:()Ljava/lang/Integer;</span><br><span class="line">     208: invokevirtual #14                 // Method java/lang/Integer.intValue:()I</span><br><span class="line">     211: goto          215</span><br><span class="line">     214: iconst_1</span><br><span class="line">     215: invokestatic  #45                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span><br><span class="line">     218: aload         6</span><br><span class="line">     220: ifnull        234</span><br><span class="line">     223: aload         6</span><br><span class="line">     225: invokevirtual #127                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRateLimitReset:()Ljava/lang/Long;</span><br><span class="line">     228: invokevirtual #51                 // Method java/lang/Long.longValue:()J</span><br><span class="line">     231: goto          235</span><br><span class="line">     234: lconst_0</span><br><span class="line">     235: invokestatic  #55                 // Method java/lang/Long.valueOf:(J)Ljava/lang/Long;</span><br><span class="line">     238: aload         6</span><br><span class="line">     240: ifnull        251</span><br><span class="line">     243: aload         6</span><br><span class="line">     245: invokevirtual #128                // Method com/secfox/store/vo/github/GithubSearchCodeVo.getRetryAfter:()Ljava/lang/Integer;</span><br><span class="line">     248: goto          252</span><br><span class="line">     251: aconst_null</span><br><span class="line">     252: invokevirtual #129                // Method com/secfox/service/github/GithubTokenManager$GithubTokenRenter.giveBackToken:(Ljava/lang/Integer;Ljava/lang/Long;Ljava/lang/Integer;)V</span><br><span class="line">     255: aload         9</span><br><span class="line">     257: athrow</span><br></pre></td></tr></table></figure>

<p>注意字节码中的这几行代码</p>
<p><img src="../static/MB19061201-1.png" alt="MB1906201-1"></p>
<p>发现<code>vo != null ? vo.getRateLimitRemain() : 1</code> 这个代码，会把<code>vo.getRateLimitRemain()</code>从Integer转成基础数据类型int，再转为Integer传给<code>giveBackToken</code>方法，而<code>vo != null ? vo.getRetryAfter() : null</code>这个代码，则不会转化为基础数据类型直接传给<code>giveBackToken</code>方法。说明了exp ? value1 : value2运算，value1和value2分别为基础数据类型和基础数据类型的包装类时，会统一转为基础数据类型。</p>
<h2 id="测试验证"><a href="#测试验证" class="headerlink" title="测试验证"></a>测试验证</h2><p>测试代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Tt tt = new Tt();</span><br><span class="line">    tt.m = 6;</span><br><span class="line">    test(tt != null ? tt.m : 2, tt != null ? tt.n : 6);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static class Tt &#123;</span><br><span class="line">    Integer m;</span><br><span class="line">    Integer n;</span><br><span class="line">&#125;</span><br><span class="line">public static void test(Integer a, Integer b) &#123;</span><br><span class="line">    System.out.println(a + &quot;--&quot; + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果为空指针异常</p>
<p>测试代码2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Tt tt = new Tt();</span><br><span class="line">    tt.m = 6;</span><br><span class="line">    test(tt != null ? tt.m : Integer.valueOf(2), tt != null ? tt.n : Integer.valueOf(6));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static class Tt &#123;</span><br><span class="line">    Integer m;</span><br><span class="line">    Integer n;</span><br><span class="line">&#125;</span><br><span class="line">public static void test(Integer a, Integer b) &#123;</span><br><span class="line">    System.out.println(a + &quot;--&quot; + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正常输出结果：6–null</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/06/12/javap-example/" data-id="ck0v87soc002jlwukwv71kno2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-github-api" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/03/github-api/" class="article-date">
  <time datetime="2019-06-03T08:48:11.000Z" itemprop="datePublished">2019-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/03/github-api/">Github Api</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="认证机制-链接"><a href="#认证机制-链接" class="headerlink" title="认证机制 链接"></a>认证机制 <a href="https://developer.github.com/v3/#authentication" target="_blank" rel="noopener">链接</a></h2><h3 id="认证方式"><a href="#认证方式" class="headerlink" title="认证方式"></a>认证方式</h3><ol>
<li>基础认证方式 <code>curl -u &quot;username&quot; https://api.github.com</code>或者<code>curl -u username:token https://api.github.com/user</code></li>
<li>OAuth认证方式<code>curl -H &quot;Authorization: token OAUTH-TOKEN&quot; https://api.github.com</code></li>
<li>Client ID 和 Client Secret认证<code>curl -i &#39;https://api.github.com/users/whatever?client_id=xxxx&amp;client_secret=yyyy&#39;</code></li>
</ol>
<h3 id="认证TOKEN及Client-ID"><a href="#认证TOKEN及Client-ID" class="headerlink" title="认证TOKEN及Client ID"></a>认证TOKEN及Client ID</h3><p>TOKEN：进入github账号<code>settings</code> -&gt; <code>Personal access tokens</code> -&gt; <code>Generate new token</code>生成token，开启repo的权限</p>
<p>Client ID：进入github账号<code>settings</code> -&gt; <code>OAuth Apps</code> </p>
<h2 id="频率限制"><a href="#频率限制" class="headerlink" title="频率限制"></a>频率限制</h2><ol>
<li>对于core、search、graphql、integration_mainfest有自定义的频率限制，其他的是统一的频率限制，可通过<code>/rate_limit</code>接口查看频率限制，返回限制数量、剩余数量、刷新时间等数据。<a href="https://developer.github.com/v3/rate_limit/" target="_blank" rel="noopener">链接</a></li>
<li>每次请求，响应头中都会返回<code>X-RateLimit</code>、<code>X-RateLimit-Remaining</code>、<code>X-RateLimit-Reset</code>参数，更新限制数量、剩余数量、刷新时间的</li>
<li>在search中，对于basic authentication、OAuth、或者client_id和secret的，每分钟最多可以有30个请求。未经验证的请求，每分钟最多10个请求。<a href="https://developer.github.com/v3/search/#rate-limit" target="_blank" rel="noopener">链接</a></li>
<li>单个用户的所有令牌，每小时共享5000个请求。<a href="https://developer.github.com/v3/#rate-limiting" target="_blank" rel="noopener">链接</a></li>
<li>经过认证的请求会增加一定量频率限制</li>
</ol>
<h2 id="请求头要求"><a href="#请求头要求" class="headerlink" title="请求头要求"></a>请求头要求</h2><ol>
<li>请求头携带属性<code>User-Agent</code><a href="https://developer.github.com/v3/#user-agent-required" target="_blank" rel="noopener">链接</a></li>
</ol>
<h2 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h2><ol>
<li><code>Location</code> 重定向，根据code判断是永久重定向还是临时重定向：<code>301</code> - 永久重定向，<code>302</code>/<code>307</code> - 临时重定向</li>
<li><code>Retry-After</code> 请求频率超限后会出现</li>
<li><code>X-RateLimit</code>、<code>X-RateLimit-Remaining</code>、<code>X-RateLimit-Reset</code>请求频率限制描述</li>
<li>code：<code>400</code> - JSON错误 Bad Request，<code>422</code> - 字段非法</li>
</ol>
<h2 id="API接口-链接"><a href="#API接口-链接" class="headerlink" title="API接口 链接"></a>API接口 <a href="https://developer.github.com/v3/search/" target="_blank" rel="noopener">链接</a></h2><h3 id="1-搜索仓库"><a href="#1-搜索仓库" class="headerlink" title="1. 搜索仓库"></a>1. 搜索仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/repositories</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>. See “<a href="https://help.github.com/articles/searching-for-repositories/" target="_blank" rel="noopener">Searching for repositories</a>“ for a detailed list of qualifiers.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query by number of <code>stars</code>, <code>forks</code>, or <code>help-wanted-issues</code> or how recently the items were <code>updated</code>. Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>通用的搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.github.com/search/repositories?q=tetris+language:assembly&amp;sort=stars&amp;order=desc</span><br></pre></td></tr></table></figure>

<p>多主题搜索</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Accept: application/vnd.github.mercy-preview+json&quot; \</span><br><span class="line">https://api.github.com/search/repositories?q=topic:ruby+topic:rails</span><br></pre></td></tr></table></figure>

<p>*<em>限定符 *</em><a href="https://help.github.com/en/articles/searching-for-repositories" target="_blank" rel="noopener">链接</a></p>
<p><code>in:name</code>，例：<code>jquery in:name</code> 限定仓库名称包含jquery</p>
<p><code>in:description</code>，例： <code>jquery in:name,description</code> 限定仓库名称或描述中包含jquery</p>
<p><code>in:readme</code>，例：<code>jquery in:readme</code> 限定readme文件中包含jquery</p>
<p><code>user: USERNAME</code>，例：<code>user:defunkt forks:&gt;100</code> 限定用户未defunkt并且有大于100个fork</p>
<p><code>org: ORGNAME</code>，例：<code>org:github</code>限定组织为github</p>
<p><code>size: n</code>， 例：<code>size:1000</code>、<code>size:&gt;=30000</code>、<code>size:&lt;50</code>、<code>size:50..120</code> 限定仓库大小为1MB、大于30MB、小于50KB、在50KB到120KB之间</p>
<p><code>forks: n</code>，例：<code>forks:5</code> 分支数量匹配</p>
<p><code>stars: n</code>，例：<code>stars:10..20</code> 星数在10到20之间</p>
<p><code>created: YYYY-MM-DD</code></p>
<p><code>pushed: YYYY-MM-DD</code></p>
<p><code>language: LANGUAGE</code></p>
<p><code>topic: TOPIC</code>，例：<code>topic:jekyll</code>主题分类是jekyll的</p>
<p><code>topics: n</code>，例：<code>topics:5</code>有5个主题分类的</p>
<p><code>license: LICENSE_KEYWORD</code>，例：<code>license:apache-2.0</code>匹配证书是Apache License 2.0的 </p>
<p><code>is:public</code>或<code>is:private</code></p>
<p><code>mirror:true</code>或<code>mirror:false</code></p>
<p><code>archived:true</code>或<code>archived:false</code></p>
<p><code>repo:USERNAME/REPONAME</code></p>
<h3 id="2-搜索提交记录"><a href="#2-搜索提交记录" class="headerlink" title="2. 搜索提交记录"></a>2. 搜索提交记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/commits</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>. See “<a href="https://help.github.com/articles/searching-commits/" target="_blank" rel="noopener">Searching commits</a>“ for a detailed list of qualifiers.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query by <code>author-date</code> or <code>committer-date</code>. Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>在octocat/Spoon-Knife仓库搜索css有关的提交</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;Accept: application/vnd.github.cloak-preview&quot; \</span><br><span class="line">https://api.github.com/search/commits?q=repo:octocat/Spoon-Knife+css</span><br></pre></td></tr></table></figure>

<h3 id="3-搜索代码"><a href="#3-搜索代码" class="headerlink" title="3. 搜索代码"></a>3. 搜索代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/code</span><br></pre></td></tr></table></figure>

<p>处于搜索的复杂性，有几个搜索限制：</p>
<ol>
<li>默认仅搜索默认分支，大部分情况下<code>master</code>分支是默认分支</li>
<li>仅搜索小于384K的文件</li>
<li>必须包含一个关键词，<code>language:go</code>是非法的，而<code>amazing language:go</code>是可行的</li>
</ol>
<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>. See “<a href="https://help.github.com/articles/searching-code/" target="_blank" rel="noopener">Searching code</a>“ for a detailed list of qualifiers.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query. Can only be <code>indexed</code>, which indicates how recently a file has been indexed by the GitHub search infrastructure. Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>在jQuery仓库中查找<code>addClass</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.github.com/search/code?q=addClass+in:file+language:js+repo:jquery/jquery</span><br></pre></td></tr></table></figure>

<p><strong>接受匹配偏移</strong></p>
<p>请求头中增加<code>Accept: application/vnd.github.v3.text-match+json</code>参数，将会在响应信息中额外接收到<code>text-matches</code>字段信息，text-matches是一组列表，列表内对象包含<code>object_url</code>、<code>object_type</code>、<code>property</code>、<code>fragment</code>、<code>matches</code>，它们用来表示查询字符串在代码中的匹配位置。<a href="https://developer.github.com/v3/search/#text-match-metadata" target="_blank" rel="noopener">链接</a></p>
<p><strong>注：在没有Authorization的情况下，存在必须指定[user|repo|org]中的一个参数限制</strong></p>
<h3 id="3-搜索问题"><a href="#3-搜索问题" class="headerlink" title="3. 搜索问题"></a>3. 搜索问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/issues</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>. See “<a href="https://help.github.com/articles/searching-issues-and-pull-requests/" target="_blank" rel="noopener">Searching issues and pull requests</a>“ for a detailed list of qualifiers.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query by the number of <code>comments</code>, <code>reactions</code>, <code>reactions-+1</code>, <code>reactions--1</code>, <code>reactions-smile</code>, <code>reactions-thinking_face</code>, <code>reactions-heart</code>, <code>reactions-tada</code>, or <code>interactions</code>. You can also sort results by how recently the items were <code>created</code> or <code>updated</code>, Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>查找最早的未解决的python问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.github.com/search/issues?q=windows+label:bug+language:python+state:open&amp;sort=created&amp;order=asc</span><br></pre></td></tr></table></figure>

<h3 id="4-搜索用户"><a href="#4-搜索用户" class="headerlink" title="4. 搜索用户"></a>4. 搜索用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/users</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>. See “<a href="https://help.github.com/articles/searching-users/" target="_blank" rel="noopener">Searching users</a>“ for a detailed list of qualifiers.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query by number of <code>followers</code> or <code>repositories</code>, or when the person <code>joined</code> GitHub. Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>查询热门用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.github.com/search/users?q=tom+repos:%3E42+followers:%3E1000</span><br></pre></td></tr></table></figure>

<h3 id="5-搜索主题"><a href="#5-搜索主题" class="headerlink" title="5. 搜索主题"></a>5. 搜索主题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/topics</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The query contains one or more search keywords and qualifiers. Qualifiers allow you to limit your search to specific areas of GitHub. The REST API supports the same qualifiers as GitHub.com. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>.</td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>搜索精选的ruby有关的主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -H &apos;Accept: application/vnd.github.mercy-preview+json&apos; \</span><br><span class="line">&apos;https://api.github.com/search/topics?q=ruby+is:featured&apos;</span><br></pre></td></tr></table></figure>

<h3 id="6-搜索标签"><a href="#6-搜索标签" class="headerlink" title="6. 搜索标签"></a>6. 搜索标签</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /search/labels</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">Type</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>repository_id</code></td>
<td align="center"><code>integer</code></td>
<td align="center"><strong>Required</strong>. The id of the repository.</td>
</tr>
<tr>
<td align="center"><code>q</code></td>
<td align="center"><code>string</code></td>
<td align="center"><strong>Required</strong>. The search keywords. This endpoint does not accept qualifiers in the query. To learn more about the format of the query, see <a href="https://developer.github.com/v3/search/#constructing-a-search-query" target="_blank" rel="noopener">Constructing a search query</a>.</td>
</tr>
<tr>
<td align="center"><code>sort</code></td>
<td align="center"><code>string</code></td>
<td align="center">Sorts the results of your query by when the label was <code>created</code> or <code>updated</code>. Default: <a href="https://developer.github.com/v3/search/#ranking-search-results" target="_blank" rel="noopener">best match</a></td>
</tr>
<tr>
<td align="center"><code>order</code></td>
<td align="center"><code>string</code></td>
<td align="center">Determines whether the first search result returned is the highest number of matches (<code>desc</code>) or lowest number of matches (<code>asc</code>). This parameter is ignored unless you provide <code>sort</code>. Default: <code>desc</code></td>
</tr>
<tr>
<td align="center">per_page</td>
<td align="center">int</td>
<td align="center">max 100</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">int</td>
<td align="center">1-based</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<p>在指定仓库查找<code>bug</code>、<code>defect</code>、<code>eenhancement</code>有关的标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -H &apos;Accept: application/vnd.github.symmetra-preview+json&apos; \</span><br><span class="line">&apos;https://api.github.com/search/labels?repository_id=64778136&amp;q=bug+defect+enhancement&apos;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/06/03/github-api/" data-id="ck0v87so2002glwuknunzfy18" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/">api</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-idea-prefer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/18/idea-prefer/" class="article-date">
  <time datetime="2019-05-18T02:32:33.000Z" itemprop="datePublished">2019-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/18/idea-prefer/">IDEA常用习惯偏好设置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="快捷键偏好设置"><a href="#快捷键偏好设置" class="headerlink" title="快捷键偏好设置"></a>快捷键偏好设置</h2><ol>
<li><p>查找(Keymap -&gt; Main Menu -&gt; Edit -&gt; Find -&gt; Find…) ：Ctrl + F    【速记：find】 </p>
</li>
<li><p>复制上一行到下一行(Keymap -&gt; Edit Actions -&gt; Duplicate Entire Lines) ： Ctrl + 向下箭头 </p>
</li>
<li><p>移动代码到上一行(Keymap -&gt; Main Menu -&gt; Code -&gt; Move Statement Up) ： Alt + 向上箭头 </p>
</li>
<li><p>移动代码到下一行(Keymap -&gt; Main Menu -&gt; Code -&gt; Move Statement Down) ： Alt + 向下箭头 </p>
</li>
<li><p>删除一行(Keymap -&gt; Editor Actions -&gt; Delete Line) ： Ctrl + D    【速记：delete】 </p>
</li>
<li><p>调出代码提示(Keymap -&gt; Main Menu -&gt; Code -&gt; Completion -&gt; Basic) ： Alt + / </p>
</li>
<li><p>自动补全返回变量(Keymap -&gt; Main Menu -&gt; Refactor -&gt; Extract -&gt; Variable…) ： Alt + Enter </p>
</li>
<li><p>显示代码在哪里被使用(Keymap -&gt; Main Menu -&gt; Edit -&gt; Find -&gt; Find Usages) ： Ctrl + U     【速记：Usage】 </p>
</li>
<li><p>代码格式化(Keymap -&gt; Main Menu -&gt; Code -&gt; Reformat Code) ：Ctrl + Shift + F    【速记：format】 </p>
</li>
<li><p>重命名(Keymap -&gt; Main Menu -&gt; Refactor -&gt; Rename…) ： Alt + Shift + R    【速记：refact】 </p>
</li>
<li><p>全局查找(Keymap -&gt; Main Menu -&gt; Edit -&gt; Find -&gt; Find in Path…)：Ctrl + P    【速记：path】 </p>
</li>
<li><p>返回或前进到上次光标所在处(Keymap -&gt; Main Menu -&gt; Navigate -&gt; Back / Forward)：Alt + 向左箭头/向右箭头</p>
</li>
<li><p>显示层级关系(Keymap -&gt; Main Menu -&gt; Navigate -&gt; Type Hierarchy)：Ctrl + H    【速记：hierarchy】 </p>
</li>
<li><p>定位到继承代码(Keymap -&gt; Main Menu -&gt; Navigate -&gt; Implementation(s))：Ctrl + Alt + Button1 Click</p>
</li>
<li><p>定位到声明代码(Keymap -&gt; Main Menu -&gt; Navigate -&gt; Declaration)：Ctrl + Button1 Click</p>
</li>
<li><p>删除Java文件不用的依赖(Keymap -&gt; Main Menu -&gt; Code -&gt; Optimize Imports)：Ctrl + Shift + O</p>
</li>
<li><p>显示参数列表(Keymap  -&gt; Main Menu -&gt; View -&gt; Parameter Info)：Alt + P    【速记：parameter】 </p>
</li>
<li><p>取消双击shift更改为其他键(双击shift -&gt; Actions)：输入registry… &gt;&gt; 其后选择点击<code>registry...</code>项 &gt;&gt; 找到<code>ide.suppress.double.click.handler</code>键名，右边打勾禁止双击shift处理 &gt;&gt; close &gt;&gt; 设置新快捷键(File =&gt; Settings… -&gt; Keymap -&gt; Other -&gt; Search Everywhere不是文件夹项)：Ctrl + W    【速记：watch或where】 </p>
</li>
</ol>
<p>CTRL为基础组合键，与ALT相关的组合键通常是代码修改的辅助有关</p>
<h2 id="其他偏好设置"><a href="#其他偏好设置" class="headerlink" title="其他偏好设置"></a>其他偏好设置</h2><ol>
<li><p>鼠标悬浮方法显示文档(Editor -&gt; General =&gt; Show quick documentation on mouse move) ：打勾 </p>
</li>
<li><p>自动为Java文件添加明确的导入依赖(Editor -&gt; General -&gt; Auto Import =&gt; Add unambiguous imports on the fly)：打勾</p>
</li>
<li><p>自动补全中显示字段名称提示(Editor -&gt; General -&gt; Code Completion =&gt; Parameter =&gt; Show parameter name hints on completion)：打勾</p>
</li>
<li><p>方法常量变量显示参数名称提示(Editor -&gt; General -&gt; Appearance =&gt; Show parameter name hints)：打勾 &gt;&gt; 点开右边Configure配置页面，Language选Java，Do not开头的取消打勾，Show开头的打勾</p>
</li>
<li><p>显示链式调用方法的参数提示(Editor -&gt; General -&gt; Appearance =&gt; Show chain call type hints)：打勾</p>
</li>
<li><p>自动提示中显示文档（与参数列表择一足矣）(Editor-&gt; General -&gt; Code Completion =&gt; Show the Documentation popup in 1000 ms)：打勾</p>
</li>
<li><p>代码字体大小调大到14(Editor -&gt; Font -&gt; Size)</p>
</li>
<li><p>Idea插件：CodeGlance（缩略图）、Rainbow Brackets（彩色括号）</p>
</li>
<li><p>新项目默认编码设置(File =&gt; Other Settings =&gt; Settings for New Projects… -&gt; Editor -&gt; File Encodings =&gt; Global Encoding和Project Encoding)：UTF-8        [已创建的项目，在File =&gt; Project Structure…设置]</p>
</li>
<li><p>新项目默认JDK设置(File =&gt; Other Settings =&gt; Structure for New Projects… -&gt; Project Settings -&gt; Platform Settings)：点击加号添加jdk，其后 &gt;&gt;  设置版本(Project Settings -&gt; Project =&gt; Project SDK)：选择环境及默认版本级别        [已创建的项目，在File =&gt; Project Structure…设置]</p>
</li>
<li><p>行代码显示最后提交信息[Other Settings -&gt; Git ToolBox Global =&gt; General -&gt; Show editor inline ‘Blame’]：打勾</p>
</li>
<li><p>方法之间显示分割线[Editor -&gt; General -&gt; Appearance =&gt; Show method separator]：打勾</p>
</li>
<li><p>文件头注释模板：File Header(Editor -&gt; File and Code Templates -&gt; Includes -&gt; File Header)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @Author: Vince</span><br><span class="line"> * @Date: $&#123;DATE&#125; $&#123;TIME&#125;</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过特殊字符触发的方法注释模板(Editor -&gt; Live Templates)：右边加号新加一个Template Group与Live Template</p>
<p><img src="../static/MB19051801-1.png" alt="MB19051801-1"></p>
<p>Abbreviation框填入<code>*</code>，Expand with选择回车，TemplateText填入生成的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line"> * </span><br><span class="line">$PARAM$</span><br><span class="line"> * @return : $RETURN$</span><br><span class="line"> * @author : Vince</span><br><span class="line"> * @date : $DATE$ $TIME$</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>

<p>字符串中包含<code>$PARAM$</code>、<code>$RETURN$</code>、<code>$DATE$</code>、<code>$TIME$</code>等变量，点击<code>Edit variables</code>编辑变量如下</p>
<p><img src="../static/MB19051801-2.png" alt="MB19051801-2"></p>
<p>其中PARAM使用groovy脚本添加参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;def result=&apos;&apos;; def params=\&quot;$&#123;_1&#125;\&quot;.replaceAll(&apos;[\\\\[|\\\\]|\\\\s]&apos;, &apos;&apos;).split(&apos;,&apos;).toList(); for(i = 0; i &lt; params.size(); i++) &#123;result+=&apos; * @param &apos; + params[i] + ((i &lt; params.size() - 1) ? &apos;\\n&apos;:&apos;&apos;)&#125;; return result&quot;, methodParameters())</span><br></pre></td></tr></table></figure>



</li>
</ol>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>File =&gt; Settings… =&gt; Keymap页面中：输入框输入用于匹配文字，输入框右侧按钮用于匹配快捷键，修改快捷键时，点击修改项，悬浮框中可选择设置键盘快捷键触发、设置鼠标配合Ctrl等键触发、缩写触发</p>
<h2 id="快捷键配置导入导出"><a href="#快捷键配置导入导出" class="headerlink" title="快捷键配置导入导出"></a>快捷键配置导入导出</h2><p>快捷键配置文件位置<a href="../static/MB19051801-1.xml">快捷键配置</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Linux：~/.IdeaIC2019.1/config/keymaps/</span><br><span class="line">Windows：C:\Users\Administrator/.IdeaIC2019.1/config/keymaps/</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/05/18/idea-prefer/" data-id="ck0v87snb001clwukdrcvut5e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IDE/">IDE</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-rabbitmq" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/22/rabbitmq/" class="article-date">
  <time datetime="2019-04-22T09:01:43.000Z" itemprop="datePublished">2019-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/22/rabbitmq/">RabbitMQ快速入门手册</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h2><p>使用docker方式，拉取镜像uetty/rabbitmq</p>
<p>具体Dockerfile的命令 -&gt; <a href="https://github.com/Uetty/dockerfile/blob/master/docker-rabbitmq/Dockerfile" target="_blank" rel="noopener">Dockerfile</a></p>
<p>额外的TIP: 由于Linux机器上会有最大打开文件个数限制，Rabbitmq又依赖文件操作，所以应将Linux的所有用户打开文件限制调高到64000，Rabbitmq程序所属的用户的打开文件限制调高到64000，这一块见官网（<a href="https://www.rabbitmq.com/install-debian.html#kernel-resource-limits" target="_blank" rel="noopener">文件限制</a>）</p>
<h2 id="2-虚拟主机"><a href="#2-虚拟主机" class="headerlink" title="2. 虚拟主机"></a>2. 虚拟主机</h2><p>Rabbitmq是多租户系统，存在虚拟主机（把它想象成为数据库）的概念，用户对它的连接、队列、绑定、路由等操作是基于虚拟主机上的。通过<code>rabbitmqctl add_vhost vhostname</code>命令来增加虚拟主机，<code>rabbitmqctl delete_vhost vhostname</code>命令来删除虚拟主机，<code>rabbitmqctl list_vhosts [name tracing]</code>命令来显示虚拟主机列表。</p>
<p>设置虚拟主机并发客户端总数：<code>rabbitmqctl set_vhost_limits -p test &#39;{&quot;max-connections&quot;: 256}&#39;</code></p>
<p>设置虚拟主机最大队列数：<code>rabbitmqctl set_vhost_limits -p test &#39;{&quot;max-queues&quot;: 1024}&#39;</code></p>
<p>显示虚拟主机参数：<code>rabbitmqctl list_vhost_limits -p test</code></p>
<h2 id="3-启动与用户操作及权限"><a href="#3-启动与用户操作及权限" class="headerlink" title="3. 启动与用户操作及权限"></a>3. 启动与用户操作及权限</h2><p>启动命令：<code>service rabbitmq-server start</code>  </p>
<p>Rabbit提供了用户名密码的方式认证和X509证书的方式认证，，这里只记用户名密码的方式 </p>
<p>初始用户：刚创建的实例，有默认的用户guest密码guest，但只能在本机登陆（不鼓励将其配置成能远程登陆，其他用户默认是可以远程访问的） </p>
<h3 id="用户设置（官网地址-）"><a href="#用户设置（官网地址-）" class="headerlink" title="用户设置（官网地址 ）"></a>用户设置（<a href="https://www.rabbitmq.com/rabbitmqctl.8.html#User_Management" target="_blank" rel="noopener">官网地址</a> ）</h3><p>添加用户：<code>rabbitmqctl add_user janeway changeit</code> </p>
<p>删除用户：<code>rabbitmqctl delete_user janeway</code> </p>
<p>变更密码：<code>rabbitmqctl change_password janeway newpass</code> </p>
<p>验证用户名密码：<code>rabbitmqctl authenticate_user janeway verifyit</code> </p>
<p>显示用户列表：<code>rabbitmqctl list_users</code> </p>
<h3 id="用户权限"><a href="#用户权限" class="headerlink" title="用户权限"></a>用户权限</h3><p>设置用户TAG：<code>rabbitmqctl set_user_tags janeway administrator</code> </p>
<p>删除用户TAG：<code>rabbitmqctl set_user_tags janeway</code> </p>
<p>TIP: 用户TAG与全局权限绑定（包括登陆可视化管理界面的权限等），具体见官网（<a href="https://www.rabbitmq.com/management.html#permissions" target="_blank" rel="noopener">TAG权限表</a>）</p>
<table>
<thead>
<tr>
<th align="left">Tag</th>
<th align="left">Capabilities</th>
</tr>
</thead>
<tbody><tr>
<td align="left">(None)</td>
<td align="left">No access to the management plugin</td>
</tr>
<tr>
<td align="left">management</td>
<td align="left">Anything the user could do via messaging protocols plus:List virtual hosts to which they can log in via AMQPView all queues, exchanges and bindings in “their” virtual hostsView and close their own channels and connectionsView “global” statistics covering all their virtual hosts, including activity by other users within them</td>
</tr>
<tr>
<td align="left">policymaker</td>
<td align="left">Everything “management” can plus:View, create and delete policies and parameters for virtual hosts to which they can log in via AMQP</td>
</tr>
<tr>
<td align="left">monitoring</td>
<td align="left">Everything “management” can plus:List all virtual hosts, including ones they could not access using messaging protocolsView other users’s connections and channelsView node-level data such as memory use and clusteringView truly global statistics for all virtual hosts</td>
</tr>
<tr>
<td align="left">administrator</td>
<td align="left">Everything “policymaker” and “monitoring” can plus:Create and delete virtual hostsView, create and delete usersView, create and delete permissionsClose other users’s connections</td>
</tr>
</tbody></table>
<p>设置用户在虚拟主机上的权限：<code>rabbitmqctl set_permissions -p vhostname username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code> 后面三个参数分别表示配置权限、写权限、读权限，引号内的内容用正则表达式匹配队列键名（不指定[–vhost/-p]参数，默认主机为’/‘ ，下同） </p>
<p>清除用户在虚拟主机上的权限：<code>rabbitmqctl clear_permissions -p vhostname username</code>  </p>
<p>显示某个用户在虚拟主机上的权限：<code>rabbitmqctl list_user_permissions uetty</code>  </p>
<p>显示某个虚拟主机上的用户权限：<code>rabbitmqctl list_permissions -p vhostname</code></p>
<h2 id="4-端口介绍"><a href="#4-端口介绍" class="headerlink" title="4. 端口介绍"></a>4. 端口介绍</h2><ul>
<li>4369: <a href="http://erlang.org/doc/man/epmd.html" target="_blank" rel="noopener">epmd</a>, a peer discovery service used by RabbitMQ nodes and CLI tools</li>
<li>5672, 5671: used by AMQP 0-9-1 and 1.0 clients without and with TLS</li>
<li>25672: used for inter-node and CLI tools communication (Erlang distribution server port) and is allocated from a dynamic range (limited to a single port by default, computed as AMQP port + 20000). Unless external connections on these ports are really necessary (e.g. the cluster uses <a href="https://www.rabbitmq.com/federation.html" target="_blank" rel="noopener">federation</a> or CLI tools are used on machines outside the subnet), these ports should not be publicly exposed. See <a href="https://www.rabbitmq.com/networking.html" target="_blank" rel="noopener">networking guide</a> for details.</li>
<li>35672-35682: used by CLI tools (Erlang distribution client ports) for communication with nodes and is allocated from a dynamic range (computed as server distribution port + 10000 through server distribution port + 10010). See <a href="https://www.rabbitmq.com/networking.html" target="_blank" rel="noopener">networking guide</a> for details.</li>
<li>15672: <a href="https://www.rabbitmq.com/management.html" target="_blank" rel="noopener">HTTP API</a> clients, <a href="https://www.rabbitmq.com/management.html" target="_blank" rel="noopener">management UI</a> and <a href="https://www.rabbitmq.com/management-cli.html" target="_blank" rel="noopener">rabbitmqadmin</a> (only if the <a href="https://www.rabbitmq.com/management.html" target="_blank" rel="noopener">management plugin</a> is enabled)</li>
<li>61613, 61614: <a href="https://stomp.github.io/stomp-specification-1.2.html" target="_blank" rel="noopener">STOMP clients</a> without and with TLS (only if the <a href="https://www.rabbitmq.com/stomp.html" target="_blank" rel="noopener">STOMP plugin</a> is enabled)</li>
<li>1883, 8883: (<a href="http://mqtt.org/" target="_blank" rel="noopener">MQTT clients</a> without and with TLS, if the <a href="https://www.rabbitmq.com/mqtt.html" target="_blank" rel="noopener">MQTT plugin</a> is enabled</li>
<li>15674: STOMP-over-WebSockets clients (only if the <a href="https://www.rabbitmq.com/web-stomp.html" target="_blank" rel="noopener">Web STOMP plugin</a> is enabled)</li>
<li>15675: MQTT-over-WebSockets clients (only if the <a href="https://www.rabbitmq.com/web-mqtt.html" target="_blank" rel="noopener">Web MQTT plugin</a> is enabled)</li>
</ul>
<p>5671端口：AMQP协议使用，且TLS加密</p>
<p>5672端口：AMQP协议使用，且不加密</p>
<p>15672端口：HTTP协议使用，或者开启可视化管理页面后，页面地址所在端口</p>
<p>61613端口：STOMP协议使用，且不加密</p>
<p>61614端口：STOMP协议使用，且TLS加密</p>
<p>1883端口：MQTT协议使用，且不加密</p>
<p>8883端口：MQTT协议使用，且TLS加密</p>
<p>15674端口：Websocket协议上的STOMP协议使用</p>
<p>15675端口：Websocket协议上的MQTT协议使用</p>
<p>TIP:  较常用的是5672端口（一般选择AMQP协议，有加密需求的化是5671端口）和15672端口</p>
<h2 id="5-交换机、队列与消息的路由"><a href="#5-交换机、队列与消息的路由" class="headerlink" title="5. 交换机、队列与消息的路由"></a>5. 交换机、队列与消息的路由</h2><p>在Rabbitmq中，生产者是将消息推送到交换机里，交换机负责将消息路由到队列中，消费者再从队列中消费消息。这里涉及到了两个概念，<code>交换机</code>和<code>队列</code>，在此基础上引申出了三个操作：<code>交换机的声明</code>、<code>队列的声明</code>、<code>交换机和队列绑定的声明</code>，这三个操作的完成是基于<code>交换机名</code>、<code>队列名</code>、<code>路由键</code>这三个属性的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1) 通过channel.exchangeDeclare(&quot;exchangeName&quot;, BuiltinExchangeType.类型);声明交换机</span><br><span class="line">2) 通过String queueName = channel.queueDeclare().getQueue();声明队列，并返回自动生成的队列的名称</span><br><span class="line">   也可以通过channel.queueDeclare(queueName, durable, exclusive, autoDelete, arguments);声明命名的队列</span><br><span class="line">   第二种声明方式的参数解释：durable为是否持久化到磁盘，它将使服务器重启后数据仍然存在；exclusive为是否排他队列，具有基于连接的排他性；autoDelete是否自动删除，在没有订阅者的情况下是否自动删除</span><br><span class="line">3) 通过channel.queueBind(queueName, &quot;exchangeName&quot;, &quot;routingKey&quot;);绑定队列和交换机</span><br></pre></td></tr></table></figure>

<p>TIP:  队列本身还包含了许多属性，例如：名称、交换代理重启后是否仍保存、自动删除、队列长度等参数，在声明队列的时候可以给定。</p>
<p>交换机种类主要有四种，以下介绍这几种交换机：</p>
<ol>
<li>直连交换机(direct)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在直连交换机的三个声明操作中，交换机名、队列名都是不能为空字符串，路由键可以为空字符串但已被使用。发送到直连交换机的消息直接根据路由键进行完全匹配，将消息路由到所有以该路由键与该交换机绑定的队列中。</span><br><span class="line"></span><br><span class="line">1) 生产者通过channel.basicPublish(&quot;exchangeName&quot;, routingKey, null, message.getBytes(&quot;UTF-8&quot;));提交数据到Rabbitmq</span><br><span class="line"></span><br><span class="line">2) 消费者通过channel.basicConsume(queueName, true, (consumerTag, delivery) -&gt; &#123;&#125;, consumerTag -&gt; &#123; &#125;);从Rabbitmq消费消息</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>扇形交换机(fanout)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">该交换机的设计思想是一个消息广播，在扇形交换机的三个声明操作中，路由键名可以为空字符串（事实上它会被忽略）。发送到扇形交换机的消息，会被路由到所有绑定在该交换机上的队列中（与直连交换机不同的是不再根据路由键进行筛选）。</span><br><span class="line"></span><br><span class="line">1) 生产者通过channel.basicPublish(&quot;exchangeName&quot;, &quot;&quot;, null, message.getBytes(&quot;UTF-8&quot;));提交数据到Rabbitmq</span><br><span class="line"></span><br><span class="line">2) 消费者通过channel.basicConsume(queueName, true, (consumerTag, delivery) -&gt; &#123;&#125;, consumerTag -&gt; &#123; &#125;);从Rabbitmq消费消息</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>主题交换机(topic)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在主题交换机的三个声明中，路由键的命名是受限制的，必须由点号分割的多个单词或星号或井号组成，*用于匹配一个单词，井号用于匹配零到多个单词，发送到主题交换机的消息，会根据路由键匹配来路由到队列中。</span><br><span class="line"></span><br><span class="line">1) 生产者通过channel.basicPublish(EXCHANGE_NAME, routingKey, null, message.getBytes(&quot;UTF-8&quot;));发送数据到Rabbitmq</span><br><span class="line"></span><br><span class="line">2) 消费者通过channel.basicConsume(queueName, true, (consumerTag, delivery) -&gt; &#123;&#125;, consumerTag -&gt; &#123; &#125;);从Rabbitmq消费消息</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>首部交换机(match 和 headers)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">在首部交换机中，路由键名可以是空字符串（事实上它会被忽略），它的路由规则转而由首部属性决定，其中最重要的一个属性是x-match，该属性有两个取值（any/all）,any表示发布消息时携带的键值对有一对能匹配上队列定义的其中一个就能，all表示所有的键值对需完全匹配。另外以x-开头的属性不被视作用于路由匹配的属性。</span><br><span class="line">该模式下，交换机和队列绑定需要增加headers值，可通过如下设置：</span><br><span class="line">Map&lt;String, Object&gt; arguments = new HashMap&lt;String, Object&gt;();</span><br><span class="line">arguments.put(&quot;x-match&quot;, &quot;any&quot;);</span><br><span class="line">arguments.put(&quot;arg1&quot;, &quot;a1&quot;);</span><br><span class="line">arguments.put(&quot;latitude&quot;, 51.5252949);</span><br><span class="line">arguments.put(&quot;dataType&quot;, &quot;json&quot;);</span><br><span class="line">channel.queueBind(queueName, EXCHANGE_NAME, &quot;&quot;, arguments);</span><br><span class="line"></span><br><span class="line">使用：</span><br><span class="line">1) 生产者通过如下代码发送消息到Rabbitmq</span><br><span class="line">Map&lt;String, Object&gt; headers = new HashMap&lt;String, Object&gt;();</span><br><span class="line">headers.put(&quot;latitude&quot;,  51.5252949);</span><br><span class="line">headers.put(&quot;longitude&quot;, -0.0905493);</span><br><span class="line">channel.basicPublish(exchangeName, &quot;&quot;,</span><br><span class="line">             new AMQP.BasicProperties.Builder()</span><br><span class="line">               .headers(headers)</span><br><span class="line">               .build(),</span><br><span class="line">               message.getBytes(&quot;UTF-8&quot;));</span><br><span class="line">               </span><br><span class="line">2) 消费者通过channel.basicConsume(queueName, true, (consumerTag, delivery) -&gt; &#123;&#125;, consumerTag -&gt; &#123; &#125;);从Rabbitmq消费消息</span><br></pre></td></tr></table></figure>

<p>默认交换机规则是一个空字符串路由键的直连交换机定义<a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-default" target="_blank" rel="noopener">官网</a>，该交换机的路由键与队列键名相同，这使其看起来像是客户端直接提交消息到了队列中。所有新建的队列都天生绑定了这个默认交换机，它的存在也方便了一些简单需求的应用直接使用Rabbitmq。</p>
<h2 id="6-ACK、TRANSACTION、RECOVERY和QOS"><a href="#6-ACK、TRANSACTION、RECOVERY和QOS" class="headerlink" title="6. ACK、TRANSACTION、RECOVERY和QOS"></a>6. ACK、TRANSACTION、RECOVERY和QOS</h2><h3 id="ACK、TRANSACTION和RECOVERY"><a href="#ACK、TRANSACTION和RECOVERY" class="headerlink" title="ACK、TRANSACTION和RECOVERY"></a>ACK、TRANSACTION和RECOVERY</h3><p>​        消费者消费队列消息时，过程中可能由于网络原因或业务原因，出现连接断开或者消费者未接收到消息或者消费者不能成功处理消息，这个时候可能会导致数据的丢失。基于这一点，Rabbitmq提供了，TRANSACRION机制、ACK机制和RECOVERY机制。</p>
<p>​        RECOVERY机制：Rabbitmq JAVA客户端提供连接恢复的功能，在启用该功能时，当客户端由于网络问题断开，会自动恢复客户端，包括恢复连接、恢复连接监听器、重新打开信道及监听器、恢复QOS设置、重新声明交换机、重新声明队列、恢复绑定和消费者，可以通过<code>factory.setAutomaticRecoveryEnabled(true)</code>来打开RECOVERY机制。</p>
<p>​        ACK机制：Rabbitmq提供了交付确认机制，可以设定自动确认交付和手动确认交付。消费者消费消息时的<code>channel.basicConsume</code>方法，第二个参数<code>autoAck</code>为<code>true</code>时表示自动确认交付，为<code>false</code>时表示手动确认交付。自动确认交付模式下，消费者从队列消费消息时立即确认交付，这时队列中立即完全删除该消息。手动确认交付模式下，客户端需告诉服务端是否确认交付，共有三种交付状态：ACK、NACK、REJECT，当客户端发送ACK时表示客户端处理成功，这时Rabbitmq才会完全删除，ACK的调用为<code>channel.basicAck(deliveryTag, false)</code>。当客户端发送NACK和REJECT时均表示交付失败，区别时NACK能批量操作，REJECT的调用为<code>channel.basicReject(deliveryTag, false)</code>，NACK的调用为<code>channel.basicNack(deliveryTag, true, true)</code>，NACK和REJECT的最后一个参数均表示交付失败的是否重新进入队列，ACK和NACK的第二个参数均表示是否包含所有未回复的交付（即是否批量回复）。</p>
<p>​        TRANSACTION机制：Rabbitmq在AMQP协议下提供了事务机制，客户端使用<code>channel.txSelect()</code>方法开启事务，使用<code>channel.txCommit()</code>方法提交事务，使用<code>channel.txRollback()</code>方法回滚事务。该机制是重量级的，并且不是必要的，根据官网的说法，它将导致吞吐量降低250倍，因此官方后面添加了也能保证数据不丢失的ACK机制。</p>
<h3 id="QOS"><a href="#QOS" class="headerlink" title="QOS"></a>QOS</h3><p>默认情况下，消费者一次会尽可能多的消费消息（根据客户端内存），设置QOS可以指定一次最高的消费量，可以使用<code>channel.basicQos(prefetchCount)</code>方法来设置。</p>
<h2 id="7-可视化界面"><a href="#7-可视化界面" class="headerlink" title="7. 可视化界面"></a>7. 可视化界面</h2><p><code>rabbitmq-plugins enable rabbitmq_management</code>命令用于开启可视化管理界面，之后添加有该权限的用户即可访问15672端口使用 </p>
<h2 id="8-JAVA访问测试"><a href="#8-JAVA访问测试" class="headerlink" title="8. JAVA访问测试"></a>8. JAVA访问测试</h2><p>POM依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;amqp-client&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;5.6.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="简单HelloWorld"><a href="#简单HelloWorld" class="headerlink" title="简单HelloWorld"></a>简单HelloWorld</h3><p>基于默认交换机，且不设QOS</p>
<p>生产者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line">import com.rabbitmq.client.Connection;</span><br><span class="line">import com.rabbitmq.client.ConnectionFactory;</span><br><span class="line">public class Send &#123;</span><br><span class="line">    private final static String QUEUE_NAME = &quot;hello&quot;,</span><br><span class="line">			ROUTING_KEY = QUEUE_NAME;</span><br><span class="line">	private static ConnectionFactory factory;</span><br><span class="line">	private static Connection conn;</span><br><span class="line">	private static synchronized Channel createConnectChannel() &#123;</span><br><span class="line">		if (factory == null) &#123;</span><br><span class="line">			factory = new ConnectionFactory();</span><br><span class="line">			factory.setHost(&quot;118.25.54.197&quot;);</span><br><span class="line">			factory.setVirtualHost(&quot;test&quot;);</span><br><span class="line">			factory.setUsername(System.getProperty(&quot;username&quot;));</span><br><span class="line">			factory.setPassword(System.getProperty(&quot;password&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		if (conn == null) &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				conn = factory.newConnection();</span><br><span class="line">			&#125; catch(Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">			Channel channel = conn.createChannel();</span><br><span class="line">			return channel;</span><br><span class="line">		&#125; catch (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		throw new RuntimeException(&quot;create failed&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	private static void closeChannel(Channel channel) &#123;</span><br><span class="line">		if (channel == null || !channel.isOpen()) return;</span><br><span class="line">		synchronized (channel) &#123;</span><br><span class="line">			if (channel.isOpen()) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					channel.close();</span><br><span class="line">				&#125; catch (IOException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125; catch (TimeoutException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	private static synchronized void closeConnection(Channel channel) &#123;</span><br><span class="line">		closeChannel(channel);</span><br><span class="line">		if (conn != null &amp;&amp; conn.isOpen()) &#123;</span><br><span class="line">			synchronized (conn) &#123;</span><br><span class="line">				if (conn != null &amp;&amp; conn.isOpen()) &#123;</span><br><span class="line">					try &#123;</span><br><span class="line">						conn.close();</span><br><span class="line">						conn = null;</span><br><span class="line">					&#125; catch (IOException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    public static void main(String[] argv) throws Exception &#123;</span><br><span class="line">        Channel channel = createConnectChannel();</span><br><span class="line">		</span><br><span class="line">		channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">		System.out.println(declare);</span><br><span class="line">		String message = &quot;Hello World...&quot;;</span><br><span class="line">		channel.basicPublish(&quot;&quot;, ROUTING_KEY, null, message.getBytes());</span><br><span class="line">		</span><br><span class="line">		System.out.println(&quot; [x] Sent &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">		closeConnection(channel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消费者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line">import com.rabbitmq.client.Connection;</span><br><span class="line">import com.rabbitmq.client.ConnectionFactory;</span><br><span class="line">import com.rabbitmq.client.DeliverCallback;</span><br><span class="line"></span><br><span class="line">public class Recv &#123;</span><br><span class="line">    private final static String QUEUE_NAME = &quot;hello&quot;;</span><br><span class="line">    ...</span><br><span class="line">    public static void main(String[] argv) throws Exception &#123;</span><br><span class="line">        Channel channel = createConnectChannel();</span><br><span class="line">		</span><br><span class="line">		channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">		</span><br><span class="line">		System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);</span><br><span class="line">		</span><br><span class="line">		CountDownLatch cdl = new CountDownLatch(1);</span><br><span class="line">		DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);</span><br><span class="line">            System.out.println(&quot; [x] Received &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">            cdl.countDown();</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class="line">        </span><br><span class="line">        cdl.await();</span><br><span class="line">        closeConnection(channel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多个消费者"><a href="#多个消费者" class="headerlink" title="多个消费者"></a>多个消费者</h3><p>基于设QOS且存在ACK的情况</p>
<p>生产者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class RabbitQueueProducer &#123;</span><br><span class="line">	...</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		Channel channel = createConnectChannel();</span><br><span class="line">		channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">		</span><br><span class="line">		Scanner sc = new Scanner(System.in);</span><br><span class="line">		String nextLine = sc.nextLine();</span><br><span class="line">		sc.close();</span><br><span class="line">		if (!nextLine.contains(&quot;.&quot;)) nextLine += &quot;.&quot;;</span><br><span class="line"></span><br><span class="line">		String message = String.join(&quot;&quot;, nextLine);</span><br><span class="line">		</span><br><span class="line">		channel.basicPublish(&quot;&quot;, QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());</span><br><span class="line">		System.out.println(&quot; [x] Sent &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">		closeConnection(channel);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消费者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class RabbitQueueConsumer &#123;</span><br><span class="line">	...</span><br><span class="line">	private static SimpleDateFormat sdf = new SimpleDateFormat(&quot;HH:mm:ss.SSS&quot;);</span><br><span class="line">	private static void doWork(String task) &#123;</span><br><span class="line">		for (char ch : task.toCharArray()) &#123;</span><br><span class="line">			if (ch == &apos;.&apos;) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					Thread.sleep(1000l);</span><br><span class="line">				&#125; catch (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">					Thread.currentThread().interrupt();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) throws IOException, InterruptedException &#123;</span><br><span class="line">		Channel channel = createConnectChannel();</span><br><span class="line">		channel.queueDeclare(QUEUE_NAME, false, false, false, null);</span><br><span class="line">		Thread.sleep(4000l);</span><br><span class="line">		channel.basicQos(1);</span><br><span class="line">		CountDownLatch cdl = new CountDownLatch(1);</span><br><span class="line">		DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);</span><br><span class="line">            long deliveryTag = delivery.getEnvelope().getDeliveryTag();</span><br><span class="line">            System.out.println(&quot; [!] Delivery TAG &apos;&quot; + deliveryTag + &quot;&apos;&quot;);</span><br><span class="line">            System.out.println(&quot; [x] Received &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">            try &#123;</span><br><span class="line">            	doWork(message);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">            	System.out.println(&quot; [x] Done&quot;);</span><br><span class="line">            	channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, false);</span><br><span class="line">            &#125;</span><br><span class="line">            boolean ack = Math.random() &gt; 0.5;</span><br><span class="line">            System.out.println(&quot; [a] ACK &apos;&quot; + ack + &quot;&apos; &quot; + sdf.format(new Date()));</span><br><span class="line">            if (ack) &#123;</span><br><span class="line">            	channel.basicAck(deliveryTag, false);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">            	channel.basicNack(deliveryTag, false, true);</span><br><span class="line">            &#125;</span><br><span class="line">            cdl.countDown();</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(&quot; [*] Waiting for messages  &quot; + sdf.format(new Date()));</span><br><span class="line">        channel.basicConsume(QUEUE_NAME, false, deliverCallback, consumerTag -&gt; &#123;</span><br><span class="line">        	System.out.println(&quot; [x] Cancel &apos;&quot; + consumerTag + &quot;&apos;&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">        cdl.await();</span><br><span class="line">        closeConnection(channel);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h3><p>生产者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class RabbitFanoutProducer &#123;	</span><br><span class="line">	private final static String EXCHANGE_NAME = &quot;fanout&quot;;</span><br><span class="line">	private final static String ROUTING_KEY = &quot;&quot;;</span><br><span class="line">	...</span><br><span class="line">	public static void main(String[] args) throws IOException &#123;</span><br><span class="line">		Channel channel = createConnectChannel();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		Scanner sc = new Scanner(System.in);</span><br><span class="line">		System.out.println(&quot; [!] Enter Message&quot;);</span><br><span class="line">		String nextLine = sc.nextLine();</span><br><span class="line">		sc.close();</span><br><span class="line">		if (!nextLine.contains(&quot;.&quot;)) nextLine += &quot;.&quot;;</span><br><span class="line"></span><br><span class="line">		String message = String.join(&quot;&quot;, nextLine);</span><br><span class="line">		</span><br><span class="line">		channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, null, message.getBytes());</span><br><span class="line">		</span><br><span class="line">		System.out.println(&quot; [x] Sent &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">		closeConnection(channel);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>消费者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class RabbitFanoutConsumer &#123;</span><br><span class="line">	private final static String EXCHANGE_NAME = &quot;fanout&quot;;</span><br><span class="line">	private final static String ROUTING_KEY = &quot;&quot;;</span><br><span class="line">	...</span><br><span class="line">	public static void main(String[] args) throws IOException, InterruptedException &#123;</span><br><span class="line">		Channel channel = createConnectChannel();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		Scanner sc = new Scanner(System.in);</span><br><span class="line">		System.out.println(&quot; [!] Enter Queue Name&quot;);</span><br><span class="line">		String queueName = sc.nextLine();</span><br><span class="line">		sc.close();</span><br><span class="line">		</span><br><span class="line">		channel.queueDeclare(queueName, false, false, false, null);</span><br><span class="line">		channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.FANOUT);</span><br><span class="line">		channel.queueBind(queueName, EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line">		</span><br><span class="line">		System.out.println(&quot; [*] Waiting for messages. To exit press CTRL+C&quot;);</span><br><span class="line">		</span><br><span class="line">		CountDownLatch cdl = new CountDownLatch(3);</span><br><span class="line">		DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span><br><span class="line">            String message = new String(delivery.getBody(), &quot;UTF-8&quot;);</span><br><span class="line">            </span><br><span class="line">            System.out.println(&quot; [x] Received &apos;&quot; + message + &quot;&apos;&quot;);</span><br><span class="line">            cdl.countDown();</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(queueName, true, deliverCallback, consumerTag -&gt; &#123; &#125;);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        cdl.await();</span><br><span class="line">        closeConnection(channel);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.uetty.com/2019/04/22/rabbitmq/" data-id="ck0v87sot002olwukdi8g7ltr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/">MyBatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/">RabbitMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dubbo/">dubbo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j/">log4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/open-source/">open source</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vulnerability/">vulnerability</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/IDE/" style="font-size: 10px;">IDE</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/linux/" style="font-size: 17.5px;">linux</a> <a href="/tags/log4j/" style="font-size: 10px;">log4j</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mysql/" style="font-size: 12.5px;">mysql</a> <a href="/tags/open-source/" style="font-size: 10px;">open source</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/vulnerability/" style="font-size: 10px;">vulnerability</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">2019-08</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">2019-07</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">2019-06</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">2019-05</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">2019-04</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">2019-03</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">2019-02</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">2018-12</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">2018-11</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018-10</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">2018-09</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">2018-08</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">2018-06</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">2018-03</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">2018-02</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">2017-12</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">2017-09</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">2017-08</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">2017-07</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">2017-05</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">2017-03</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/15/log4j/">log4j xml配置文件个人配置如何不污染GIT远程仓库</a>
          </li>
        
          <li>
            <a href="/2019/07/31/common-excel/">阿里Easy Excel自定义样式注解</a>
          </li>
        
          <li>
            <a href="/2019/07/29/compare-list-vertor-cowlist/">ArrayList、Vector、CopyOnWriteArrayList对比</a>
          </li>
        
          <li>
            <a href="/2019/07/17/java-garbage-collector/">JAVA垃圾收集器科普</a>
          </li>
        
          <li>
            <a href="/2019/07/10/java-linux-timezone/">Java及Ubuntu操作系统时区错误</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Vince<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>